<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Public Diary</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto&family=Georgia&family=Courier+New&family=Comic+Neue&display=swap">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
body { margin:0; padding:20px; font-family:'Roboto', sans-serif; }
h1 { text-align:center; margin-bottom:10px; }
.controls { text-align:center; margin-bottom:15px; }
textarea { width:100%; height:150px; padding:12px; font-size:14px; border-radius:8px; resize:none; }
button, select, input[type=color] { margin:5px; padding:8px 12px; border-radius:6px; cursor:pointer; font-size:14px; }
#entryDisplay { margin-top:20px; padding:12px; border-radius:8px; border:1px solid #ccc; min-height:50px; white-space:pre-wrap; word-wrap:break-word; }
</style>
</head>
<body>
<h1>ðŸ“– Public Diary</h1>

<div class="controls">
<label>Font:</label>
<select id="font" onchange="updateStyle()">
<option value="'Roboto', sans-serif">Roboto</option>
<option value="Georgia, serif">Georgia</option>
<option value="'Courier New', monospace">Courier New</option>
<option value="'Comic Neue', cursive">Comic Neue</option>
</select>

<label>Style:</label>
<select id="style" onchange="updateStyle()">
<option value="normal">Normal</option>
<option value="italic">Italic</option>
<option value="bold">Bold</option>
</select>

<label>Text Color:</label>
<input type="color" id="color" value="#333333" onchange="updateStyle()">
</div>

<textarea id="entry" placeholder="Write your diary entry..."></textarea><br>
<button onclick="submitEntry()">Submit</button>

<h2>Diary Entry</h2>
<div id="entryDisplay"></div>

<script>
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const entryArea = document.getElementById("entry");
const entryDisplay = document.getElementById("entryDisplay");

function updateStyle() {
  entryArea.style.fontFamily = document.getElementById("font").value;
  entryArea.style.fontStyle = document.getElementById("style").value==='italic'?'italic':'normal';
  entryArea.style.fontWeight = document.getElementById("style").value==='bold'?'bold':'normal';
  entryArea.style.color = document.getElementById("color").value;
}

function submitEntry() {
  const text = entryArea.value.trim();
  if(!text) return alert("Write something!");
  const entryData = {
    text,
    font: document.getElementById("font").value,
    style: document.getElementById("style").value,
    color: document.getElementById("color").value,
    date: new Date().toISOString()
  };
  showEntry(entryData);       // show locally immediately
  db.ref('latestEntry').set(entryData); // save to Firebase
  entryArea.value = "";
}

// Display entry safely (no innerHTML)
function showEntry(e) {
  entryDisplay.innerHTML = ""; // clear previous
  const div = document.createElement("div");
  div.style.fontFamily = e.font;
  div.style.fontStyle = e.style==='italic'?'italic':'normal';
  div.style.fontWeight = e.style==='bold'?'bold':'normal';
  div.style.color = e.color;
  div.textContent = e.text; // safe text node
  entryDisplay.appendChild(div);
}

// Listen for latest entry from Firebase
db.ref('latestEntry').on('value', snapshot => {
  const e = snapshot.val();
  if(e) showEntry(e);
});

updateStyle();
</script>
</body>
</html>
